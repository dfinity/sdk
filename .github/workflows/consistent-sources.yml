name: Check that nix/sources.json and scripts/dfx-asset-sources.sh are consistent
on:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
  push:
    branches:
      - master

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install shellcheck
        run: |
          ./scripts/write-dfx-asset-sources.sh
          if [ -z "$(git status --porcelain)" ]
          then
            exit 0
          else
            git diff
            echo "scripts/dfx-asset-sources.sh is out of date.  Please run:"
            echo "    scripts/write-dfx-asset-sources.sh"
            exit 1
          fi
