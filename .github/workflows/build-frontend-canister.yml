name: Update frontend canister

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  frontend:
    runs-on: ubuntu-latest
    name: frontend-canister-up-to-date:required
    steps:
      - name: Check out the repo
        uses: actions/checkout@v2
      - name: Set up
        run: |
          rustup target add wasm32-unknown-unknown
          cargo install --version 0.2.0 ic-wasm
      - name: Build frontend canister
        run: |
          ./scripts/update-frontend-canister.sh
      - name: Update wasm
        run: |
          if [ "$(git diff src/distributed/assetstorage.wasm.gz)" != "" ]
          then
            git config user.name "GitHub Actions Bot"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add src/distributed/assetstorage.wasm.gz
            git commit -m "update src/distributed/assetstorage.wasm.gz" || true
            git push
          fi
